---
title: "CBS EVAL.R"
author: "Changhua Yu"
date: "4/2/2019"
output: html_document
---
# A demo for CBS Submission evaluation package
```{r, echo=T, results='hide',message=FALSE}
source("../GAA-EVAL.R")
```

## Read in the Experimental data provided by CAGI
```{r, echo=T, results='hide',message=FALSE}
exp.data.10.h <- read.RealData(file = "exp_2010.csv", sep = ":",
                             col.id = 1, col.value = 2, col.sd = 3)
exp.data.10.h
exp.data.10.l <- read.RealData(file = "exp_2010.csv", sep = ":",
                             col.id = 1, col.value = 4, col.sd = 5)
exp.data.10.l

exp.data.11.h <- read.RealData(file = "exp_2011.csv", sep = "\t",
                             col.id = 1, col.value = 2, col.sd = 3,na.character = 'NA')
exp.data.11.h

exp.data.11.l <- read.RealData(file = "exp_2011.csv", sep = "\t",
                             col.id = 1, col.value = 4, col.sd = 5,na.character = 'NA')
exp.data.11.l
```

## Read in the submission folders
```{r, echo=T, results='hide',message=FALSE}
sub.data.10.h <- read.Submission.Folder(folder.name = "prediction_2010/",col.id = 1,
                                      col.value = 2, col.sd = 3, real.data = exp.data.10.h)

sub.data.10.l <- read.Submission.Folder(folder.name = "prediction_2010/",col.id = 1,
                                      col.value = 4, col.sd = 5, real.data = exp.data.10.l)

sub.data.11.h <- read.Submission.Folder(folder.name = "prediction_2011/",col.id = 1,
                                      col.value = 2, col.sd = 3, real.data = exp.data.11.h)
sub.data.11.l <- read.Submission.Folder(folder.name = "prediction_2011/",col.id = 1,
                                      col.value = 4, col.sd = 5, real.data = exp.data.11.l)
```

## for 2010 high
### Correlation-based Evaluation with bootstrap
  method = "pearson"
  sd.use = NA: no filter on the experimental sd value
  z.transformation does not have effect to pearson correlation

```{r}
# 1. Render coefficient value
boot.result.cor.pearson.10.h <- eval.Correlation(real.data = exp.data.10.h, pred.data = sub.data.10.h,
                                       method = "pearson", sd.use = NA,z.transform = F,boot = T)
# For Correlation-based Evaluation, provide mean, CI, and median pval
head(boot.result.cor.pearson.10.h$summary)
head(boot.result.cor.pearson.10.h$rawdat)
# 2. Plot Correlation
plot.Correlation(boot.result.cor.pearson.10.h$summary, "Pearson",boot = TRUE)
```

> Bootstrap using distribution modelling 
  boot = T, boot.var = T

```{r}
bootvar.result.cor.pearson.10.h <- eval.Correlation(real.data = exp.data.10.h, pred.data = sub.data.10.h,
                                       method = "pearson", sd.use = NA,z.transform = F,boot = T,boot.var = T)
head(bootvar.result.cor.pearson.10.h$summary)
plot.Correlation(bootvar.result.cor.pearson.10.h$summary, "Pearson",boot = TRUE)
```

  method = "kendall"
  sd.use = NA: no filter on the experimental sd value

```{r}
# 1. Render coefficient value
boot.result.cor.kendall.10.h <- eval.Correlation(real.data = exp.data.10.h, pred.data = sub.data.10.h,
                                       method = "kendall", sd.use = NA,z.transform = F,boot = T)
# For Correlation-based Evaluation, provide mean, CI, and median pval
head(boot.result.cor.kendall.10.h$summary)
head(boot.result.cor.kendall.10.h$rawdat)
# 2. Plot Correlation
plot.Correlation(boot.result.cor.kendall.10.h$summary, "kendall",boot = TRUE)
```

  method = "spearman"
  sd.use = NA: no filter on the experimental sd value

```{r}
# 1. Render coefficient value
boot.result.cor.spearman.10.h <- eval.Correlation(real.data = exp.data.10.h, pred.data = sub.data.10.h,
                                       method = "spearman", sd.use = NA,z.transform = F,boot = T)
# For Correlation-based Evaluation, provide mean, CI, and median pval
head(boot.result.cor.spearman.10.h$summary)
head(boot.result.cor.spearman.10.h$rawdat)
# 2. Plot Correlation
plot.Correlation(boot.result.cor.spearman.10.h$summary, "spearman",boot = TRUE)
```

## RMSD-based Evaluation 
>   - (for demonstration, only present the bootstrapped result)
    - variance.normalization: defined on PPT
    - density.distance: RMSD based on distribution model of experimental value
   
```{r}
# with variance.normalization + without density.distance
boot.result.rmsd2.10.h <- eval.RMSD(real.data = exp.data.10.h, pred.data = sub.data.10.h,sd.use = NA, 
                      density.distance = FALSE,variance.normalization = TRUE,boot = TRUE)
head(boot.result.rmsd2.10.h)
plot.RMSD(boot.result.rmsd2.10.h, method="",boot = TRUE)

# with variance.normalization + with density.distance
boot.result.rmsd.10.h <- eval.RMSD(real.data = exp.data.10.h, pred.data = sub.data.10.h,sd.use = NA, 
                      density.distance = TRUE, variance.normalization = TRUE, boot = TRUE)
head(boot.result.rmsd.10.h)
plot.RMSD(boot.result.rmsd.10.h, method="",boot = TRUE)
```

## Cut-off-based Evaluation
   threshold = 0.6: The cutoff for positive/negative value
```{r}
result.auc.10.h <- eval.AUC(real.data =exp.data.10.h, pred.data = sub.data.10.h, 
                           threshold = 0)
head(result.auc.10.h$results)
plot.AUC.bar(result.auc.10.h$results)
```

## Uniqueness Evaluation
   uniqueness as adj.r^2 difference between total linear model and linear models without certain group
   use.ci = T : if true error bar as confidence interval; if false, error bar as standard deviation
   
```{r}
# resampling row
result.uniq.10.h = eval.uniqueness(real.data = exp.data.10.h, pred.data = sub.data.10.h,boot = TRUE)
result.uniq.10.h
plot.uniqueness(result.uniq.10.h, method="", boot = TRUE,use.ci = T)
plot.uniqueness(result.uniq.10.h, method="", boot = TRUE,use.ci = F)
# generating from experimental distribution
result.bootvar.uniq.10.h = eval.uniqueness(real.data = exp.data.10.h, pred.data = sub.data.10.h,boot = TRUE,boot.var = T)
result.bootvar.uniq.10.h
plot.uniqueness(result.bootvar.uniq.10.h, method="",boot = TRUE,use.ci = F)
```

